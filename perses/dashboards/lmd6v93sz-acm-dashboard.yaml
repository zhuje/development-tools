apiVersion: perses.dev/v1alpha2
kind: PersesDashboard
metadata:
  labels:
    app.kubernetes.io/name: perses-dashboard
    app.kubernetes.io/instance: lmd6v93sz
    app.kubernetes.io/part-of: perses-operator
  name: lmd6v93sz
  namespace: openshift-cluster-observability-operator
spec:
  config:
    display:
      name: Service Level dashboards / Virtual Machines by Time in Status
    panels:
      "0":
        kind: Panel
        spec:
          display:
            name: Total Allocated CPU
            description: The total CPUs of the VMs that are listed in the dashboard
          plugin:
            kind: StatChart
            spec:
              calculation: last-number
              colorMode: value
              format:
                unit: decimal
              metricLabel: ""
              sparkline: {}
              thresholds:
                steps:
                  - color: "#73bf69"
                    value: 0
                  - color: "#f2495c"
                    value: 80
          queries:
            - kind: TimeSeriesQuery
              spec:
                plugin:
                  kind: PrometheusTimeSeriesQuery
                  spec:
                    minStep: ""
                    query: >-
                      sum (

                      (
                          sum by (cluster, namespace, name) (
                          kubevirt_vm_resource_requests{cluster=~"$cluster", name=~"$name", namespace=~"$namespace", resource="cpu", unit="cores", source=~"default|domain"}
                          * ignoring (unit)(kubevirt_vm_resource_requests{cluster=~"$cluster", name=~"$name", namespace=~"$namespace", resource="cpu", unit="sockets", source=~"default|domain"})
                          * ignoring (unit)(kubevirt_vm_resource_requests{cluster=~"$cluster", name=~"$name", namespace=~"$namespace", resource="cpu", unit="threads", source=~"default|domain"})
                          ) or
                          sum by (cluster, namespace, name) (
                          kubevirt_vm_resource_requests{cluster=~"$cluster", name=~"$name", namespace=~"$namespace", resource="cpu", unit="cores", source=~"default|domain"}
                          * ignoring (unit)(kubevirt_vm_resource_requests{cluster=~"$cluster", name=~"$name", namespace=~"$namespace", resource="cpu", unit="sockets", source=~"default|domain"})
                          )
                           or
                          sum by (cluster, namespace, name) (
                          kubevirt_vm_resource_requests{cluster=~"$cluster", name=~"$name", namespace=~"$namespace", resource="cpu", unit="cores", source=~"default|domain"})
                      )
                        + on(cluster, name, namespace) group_left(status)
                        0*(
                          (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                        )
                        +${status:raw}
                      ) 
                    seriesNameFormat: ""
      "1":
        kind: Panel
        spec:
          display:
            name: Total Allocated Memory
            description: The total Memory of the VMs that are listed in the dashboard
          plugin:
            kind: StatChart
            spec:
              calculation: last-number
              colorMode: value
              format:
                unit: bytes
              metricLabel: ""
              sparkline: {}
              thresholds:
                steps:
                  - color: "#73bf69"
                    value: 0
                  - color: "#f2495c"
                    value: 80
          queries:
            - kind: TimeSeriesQuery
              spec:
                plugin:
                  kind: PrometheusTimeSeriesQuery
                  spec:
                    minStep: ""
                    query: >-
                      sum(

                      max by (cluster, namespace, name, status)(
                        (kubevirt_vm_resource_requests{cluster=~"$cluster", name=~"$name", namespace=~"$namespace", resource="memory"})
                        + on(cluster, name, namespace) group_left(status)
                        0*(
                          (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                        )
                        +${status:raw}
                      ))
                    seriesNameFormat: ""
      "2":
        kind: Panel
        spec:
          display:
            name: Total Allocated Disk
            description: The total disk size of the VMs that are listed in the dashboard
          plugin:
            kind: StatChart
            spec:
              calculation: last-number
              colorMode: value
              format:
                unit: bytes
              metricLabel: ""
              sparkline: {}
              thresholds:
                steps:
                  - color: "#73bf69"
                    value: 0
                  - color: "#f2495c"
                    value: 80
          queries:
            - kind: TimeSeriesQuery
              spec:
                plugin:
                  kind: PrometheusTimeSeriesQuery
                  spec:
                    minStep: ""
                    query: >-
                      sum (
                        (kubevirt_vm_disk_allocated_size_bytes{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"})
                        + on(cluster, name, namespace) group_left(status)
                        0*(
                          (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                        )
                        +${status:raw}
                      ) 
                    seriesNameFormat: ""
      "3":
        kind: Panel
        spec:
          display:
            name: Virtual Machines List by Time In Status
          plugin:
            kind: Table
            spec:
              columnSettings:
                - hide: true
                  name: timestamp
                - header: Cluster
                  name: cluster
                - header: ""
                  hide: true
                  name: clusterID
                - hide: true
                  name: container
                - hide: true
                  name: endpoint
                - hide: true
                  name: instance
                - hide: true
                  name: job
                - header: Namespace
                  name: namespace
                - dataLink:
                    openNewTab: true
                    title: ""
                    url: /d/RnxEyj6Sz/executive-dashboards-single-virtual-machine-view?orgId=1&var-cluster=${__data.fields.Cluster}&var-name=${__data.fields["VM
                      Name"]}&var-namespace=${__data.fields.Namespace}
                  header: VM Name
                  name: name
                - hide: true
                  name: pod
                - hide: true
                  name: receive
                - hide: true
                  name: service
                - header: Status
                  name: status
                - header: ""
                  hide: true
                  name: tenant_id
                - header: ""
                  hide: true
                  name: clusterType
                - header: Allocated CPU
                  name: "Value #F"
                - header: Allocated Memory
                  name: "Value #E"
                - header: Allocated Disk
                  name: "Value #A"
                - header: Time Since Last Migration
                  name: "Value #C"
                - header: Last Migration
                  hide: true
                  name: "Value #D"
                - header: Time in Status
                  hide: false
                  name: "Value #B"
                - header: Time in Status
                  name: value
              transforms:
                - kind: MergeSeries
                  spec: {}
          queries:
            - kind: TimeSeriesQuery
              spec:
                plugin:
                  kind: PrometheusTimeSeriesQuery
                  spec:
                    minStep: ""
                    query: >
                      sum by (cluster, namespace, name, status)(
                        (kubevirt_vm_disk_allocated_size_bytes{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"})
                        + on(cluster, name, namespace) group_left(status)
                        0*(
                          (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                        )
                        +${status:raw}
                      )
                    seriesNameFormat: ""
            - kind: TimeSeriesQuery
              spec:
                plugin:
                  kind: PrometheusTimeSeriesQuery
                  spec:
                    minStep: ""
                    query: >2
                        (
                          (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", "")) > $days_in_status_gt * 24 * 60 * 60
                          ) and (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", "")) < $days_in_status_lt * 24 * 60 * 60
                          )
                        ) +${status:raw}
                        or
                        (
                          (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", "")) > $days_in_status_gt * 24 * 60 * 60
                          ) and (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", "")) < $days_in_status_lt * 24 * 60 * 60
                          )
                        ) +${status:raw}
                        or
                        (
                          (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", "")) > $days_in_status_gt * 24 * 60 * 60
                          ) and (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", "")) < $days_in_status_lt * 24 * 60 * 60
                          )
                        ) +${status:raw}
                        or
                        (
                          (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", "")) > $days_in_status_gt * 24 * 60 * 60
                          ) and (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", "")) < $days_in_status_lt * 24 * 60 * 60
                          )
                        ) +${status:raw}
                        or
                        (
                          (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", "")) > $days_in_status_gt * 24 * 60 * 60
                          ) and (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", "")) < $days_in_status_lt * 24 * 60 * 60
                          )
                         +${status:raw}
                      )
                    seriesNameFormat: ""
            - kind: TimeSeriesQuery
              spec:
                plugin:
                  kind: PrometheusTimeSeriesQuery
                  spec:
                    minStep: ""
                    query: >
                      sum by (cluster, namespace, name, status)(
                        (kubevirt_vmi_migration_end_time_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"}*1000)
                        + on(cluster, name, namespace) group_left(status)
                        0*(
                          (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                        )
                        +${status:raw}
                      )
                    seriesNameFormat: ""
            - kind: TimeSeriesQuery
              spec:
                plugin:
                  kind: PrometheusTimeSeriesQuery
                  spec:
                    minStep: ""
                    query: >
                      sum by (cluster, namespace, name, status)(
                        (kubevirt_vmi_migration_end_time_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"}*1000)
                        + on(cluster, name, namespace) group_left(status)
                        0*(
                          (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                        )
                        +${status:raw}
                      )
                    seriesNameFormat: ""
            - kind: TimeSeriesQuery
              spec:
                plugin:
                  kind: PrometheusTimeSeriesQuery
                  spec:
                    minStep: ""
                    query: >
                      max by (cluster, namespace, name, status)(
                        (kubevirt_vm_resource_requests{cluster=~"$cluster", name=~"$name", namespace=~"$namespace", resource="memory"})
                        + on(cluster, name, namespace) group_left(status)
                        0*(
                          (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                        )
                        +${status:raw}
                      )
                    seriesNameFormat: ""
            - kind: TimeSeriesQuery
              spec:
                plugin:
                  kind: PrometheusTimeSeriesQuery
                  spec:
                    minStep: ""
                    query: >-
                      (
                          sum by (cluster, namespace, name) (
                          kubevirt_vm_resource_requests{cluster=~"$cluster", name=~"$name", namespace=~"$namespace", resource="cpu", unit="cores", source=~"default|domain"}
                          * ignoring (unit)(kubevirt_vm_resource_requests{cluster=~"$cluster", name=~"$name", namespace=~"$namespace", resource="cpu", unit="sockets", source=~"default|domain"})
                          * ignoring (unit)(kubevirt_vm_resource_requests{cluster=~"$cluster", name=~"$name", namespace=~"$namespace", resource="cpu", unit="threads", source=~"default|domain"})
                          ) or
                          sum by (cluster, namespace, name) (
                          kubevirt_vm_resource_requests{cluster=~"$cluster", name=~"$name", namespace=~"$namespace", resource="cpu", unit="cores", source=~"default|domain"}
                          * ignoring (unit)(kubevirt_vm_resource_requests{cluster=~"$cluster", name=~"$name", namespace=~"$namespace", resource="cpu", unit="sockets", source=~"default|domain"})
                          )
                           or
                          sum by (cluster, namespace, name) (
                          kubevirt_vm_resource_requests{cluster=~"$cluster", name=~"$name", namespace=~"$namespace", resource="cpu", unit="cores", source=~"default|domain"})
                      )
                        + on(cluster, name, namespace) group_left(status)
                        0*(
                          (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_starting_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "starting", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "running", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_non_running_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "stopped", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_error_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "error", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                          or
                          (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            > ($days_in_status_gt * 24 * 60 * 60)
                          ) and (
                            (time() - label_replace(kubevirt_vm_migrating_status_last_transition_timestamp_seconds{cluster=~"$cluster", name=~"$name", namespace=~"$namespace"} > 0, "status", "migrating", "", ""))
                            < ($days_in_status_lt * 24 * 60 * 60)
                          )
                        )
                        +${status:raw}
                    seriesNameFormat: ""
    layouts:
      - kind: Grid
        spec:
          display:
            title: Panel Group 1
            collapse:
              open: true
          items:
            - x: 0
              "y": 0
              width: 8
              height: 3
              content:
                $ref: "#/spec/panels/0"
            - x: 8
              "y": 0
              width: 8
              height: 3
              content:
                $ref: "#/spec/panels/1"
            - x: 16
              "y": 0
              width: 8
              height: 3
              content:
                $ref: "#/spec/panels/2"
            - x: 0
              "y": 3
              width: 24
              height: 16
              content:
                $ref: "#/spec/panels/3"
    variables:
      - kind: ListVariable
        spec:
          display:
            name: Cluster
            hidden: false
          defaultValue:
            - $__all
          allowAllValue: true
          allowMultiple: true
          customAllValue: .*
          sort: none
          plugin:
            kind: PrometheusLabelValuesVariable
            spec:
              labelName: cluster
              matchers:
                - kubevirt_vm_running_status_last_transition_timestamp_seconds
          name: cluster
      - kind: ListVariable
        spec:
          display:
            name: Namespace
            description: Filter the Virtual Machine by its Namespace
            hidden: false
          defaultValue:
            - $__all
          allowAllValue: true
          allowMultiple: true
          customAllValue: .*
          sort: none
          plugin:
            kind: PrometheusLabelValuesVariable
            spec:
              labelName: namespace
              matchers:
                - kubevirt_vmi_info
          name: namespace
      - kind: ListVariable
        spec:
          display:
            name: VM Name
            description: Filter the Virtual Machine by its name
            hidden: false
          defaultValue:
            - $__all
          allowAllValue: true
          allowMultiple: true
          customAllValue: .*
          sort: none
          plugin:
            kind: PrometheusLabelValuesVariable
            spec:
              labelName: name
              matchers:
                - kubevirt_vmi_info
          name: name
      - kind: ListVariable
        spec:
          display:
            name: Status
            hidden: false
          defaultValue: on(cluster,name,namespace) group_left()(0*(sum
            by(cluster,namespace,name)(kubevirt_vm_info)))
          allowAllValue: false
          allowMultiple: false
          plugin:
            kind: StaticListVariable
            spec:
              values:
                - label: All
                  value: on(cluster,name,namespace) group_left()(0*(sum
                    by(cluster,namespace,name)(kubevirt_vm_info)))
                - label: stopped
                  value: on(cluster,name,namespace) group_left()(0*(sum
                    by(cluster,namespace,name)(kubevirt_vm_info{status_group="non_running"}>0)))
                - label: starting
                  value: on(cluster,name,namespace) group_left()(0*(sum
                    by(cluster,namespace,name)(kubevirt_vm_info{status_group="starting"}
                    > 0)))
                - label: migrating
                  value: on(cluster, name, namespace) group_left() (0*(sum by (cluster, namespace,
                    name)(kubevirt_vm_info{status_group="migrating"}>0)))
                - label: error
                  value: on(cluster,name,namespace) group_left()(0*(sum
                    by(cluster,namespace,name)(kubevirt_vm_info{status_group="error"}>0)))
                - label: running
                  value: on(cluster,name,namespace) group_left()(0*(sum
                    by(cluster,namespace,name)(kubevirt_vm_info{status_group="running"}>0)))
          name: status
      - kind: TextVariable
        spec:
          display:
            name: Days in Status >
            description: Filter the Virtual Machines that are in the specific status for
              more then the selected number of days
            hidden: false
          value: "0"
          name: days_in_status_gt
      - kind: TextVariable
        spec:
          display:
            name: Days in Status <
            description: Filter the Virtual Machines that are in the specific status for
              less then the selected number of days
            hidden: false
          value: "1000"
          name: days_in_status_lt
    duration: 1h
    refreshInterval: 0s
